"use strict";var __awaiter=function(o,a,s,l){return new(s||(s=Promise))(function(t,e){function n(t){try{r(l.next(t))}catch(t){e(t)}}function i(t){try{r(l.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,i)}r((l=l.apply(o,a||[])).next())})},__generator=function(n,i){var r,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=i.call(n,s)}catch(t){e=[6,t],o=0}finally{r=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},Modal=function(){function t(){this.overlayContainerID="overlay",this.overlayContainerGuts="overlayGuts",this.isOpen=!1,this.addOverlay()}return t.prototype.addOverlay=function(){document.getElementById("main-content").insertAdjacentHTML("beforeend","<div id='overlay'><div id='overlay-content'><a class='closebtn'><i class='fa fa-times'></i></a><div id='overlayGuts' class='col1of1 responsive-container'></div></div></div>")},t.prototype.updateOverlayContent=function(t){document.getElementById(this.overlayContainerGuts).innerHTML=t},t.prototype.openOverlay=function(t){var e=this,n=window.scrollY;window.scroll(0,n);var i=document.getElementById(this.overlayContainerID),r=document.getElementById(this.overlayContainerGuts);this.updateOverlayContent(t),i.style.height="100%",i.style.display="block",document.body.classList.add("modal-open"),i.getElementsByClassName("closebtn")[0].addEventListener("click",function(t){e.closeOverlay(r,i,n),t.preventDefault()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&(e.closeOverlay(r,i,n),t.preventDefault())}),this.isOpen=!0},t.prototype.closeOverlay=function(t,e,n){t.innerHTML="",e.style.height="0%",e.style.display="none",document.body.classList.remove("modal-open"),window.scroll(0,n),this.isOpen=!1},t}();function removeSpecialChars(t){return t.replace(/[`~!@#$%^&*()_|+\-=?;:'",<>\{\}\[\]\\\/]/gi,"")}var Item=function(){function t(t){this.id=t.id,this.title=t.title,this.element=t.element,this.renewElement=t.renewElement,this.type=t.type,this.software=!1;var e=removeSpecialChars(t.price);isNaN(e)?t.price=0:this.price=removeSpecialChars(e),this.image=t.image.path,this.desc=t.desc,this.onCart=!!t.onCart,this.renew=!!t.renew}return t.prototype.outputOverlay=function(t){void 0===t&&(t=null);var e=this.onCart?"Remove From Cart":"Add To Cart",n=this.onCart?"onCart":"",i='<div id="overlayPad" data-id="'+this.id+'" >\n        <div class="bootstrap-wrapper">\n    <div class="container">\n    <div class="row">';return"/"!=this.image&&(i+='<div class="col-12 col-lg-6 overlayImg">\n                        <div>\n                            <img src="https://feinberg-dev.fsm.northwestern.edu/it-new/'+this.image+'" />\n                        </div>\n                    </div>'),i+='<div class="col-12 col-lg-6 overlayText">\n                        \n                            <h3>'+this.title,!this.catStr.includes("software")||this.renew&&(i+=" - Renewing"),i+="</h3>\n                        ","0.00"!=this.price&&(i+="<h6>$"+this.numberWithCommas(this.price)+"</h6>"),"string"==typeof this.desc?i+="<div>"+this.desc+"</div><br />":i+="<br />","0.00"!=this.price&&(this.catStr.includes("software")&&(i+='<div class="renewModalSelect">\n                    <label>Purchase or Renew\n                    Software Licence: </label>\n                    <select class="renewModalInput" data-id="'+this.id+'" ',this.onCart&&(i+=" disabled "),i+='>\n                        <option value="new">New</option>\n                        <option value="renew" ',this.renew&&(i+=' selected="selected" '),i+=">Renew</option></select>",i+="</div>"),i+='<a id="atcModalBtn" href="#" \n                            class="button '+n+'" \n                            data-num="'+t+'" \n                            data-id="'+this.id+'"\n                            data-catstr="'+this.catStr+'"    \n                        >'+e+"</a>"),i+="</div>\n            </div>\n            </div>\n            </div>\n        </div>"},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t}(),Cart=function(){function t(t,e,n){this.machformBase="https://forms.feinberg.northwestern.edu/view.php?id=48491",this.basket=[],this.mappedBasket=[],this.softwareAltIds=[],this.cartCount=0,this.cartTotal=0,this.cartBtnTxt={Add:"Add To Cart",Remove:"Remove From Cart",Info:"More Info"},this.modal=t,this.cookie=e,this.softwareCookie=n,this.makeCartInBrowser()}return t.prototype.mapCart=function(){if(this.mappedBasket=this.basket.map(function(t){return t.id}),this.softwareAltIds=this.basket.map(function(t){if(t.renew)return t.id}),0<this.mappedBasket.length){var t=JSON.stringify(this.mappedBasket);if(this.cookie.setCookie(t,1),0<this.softwareAltIds.length){var e=JSON.stringify(this.mappedBasket);this.softwareCookie.setCookie(e,1)}else this.softwareCookie.deleteCookie()}else this.cookie.deleteCookie(),this.softwareCookie.deleteCookie()},t.prototype.addOrRemoveFromCart=function(n){var i;if(0<this.basket.length){var t;if(this.basket.forEach(function(t,e){t.id===n.id&&(i=e)}),-1===i||void 0===i)return(t=this.addToBasket(n))&&this.toggleSoftwareSelects(n.id),this.updateCartTotalAndCount(),t;for(var e=this.removeFromBasket(i)[0],r=document.getElementsByClassName("atcBtn"),o=0;o<r.length;o++){var a=r[o].getAttribute("data-id");e.id==a&&(this.toggleATCbutton(r[o],!1),this.toggleSoftwareSelects(a))}return this.updateCartTotalAndCount(),!1}if(null!=n.id||null!=n.id)return(t=this.addToBasket(n))&&this.toggleSoftwareSelects(n.id),this.updateCartTotalAndCount(),t},t.prototype.toggleSoftwareSelects=function(t){if(t){var e=document.querySelectorAll('select[data-id="'+t+'"]');-1!=this.inBasket(t)?e.forEach(function(t){t.setAttribute("disabled","disabled")}):e.forEach(function(t){t.removeAttribute("disabled")})}},t.prototype.addToBasket=function(t){return this.basket.push(t),!0},t.prototype.removeFromBasket=function(t){return this.basket.splice(t,1)},t.prototype.inBasket=function(n){var i=-1;return this.basket.forEach(function(t,e){t.id===n&&(i=e)}),i},t.prototype.totalCart=function(){if(0<this.basket.length){var e=0;return this.basket.forEach(function(t){e+=parseFloat(removeSpecialChars(t.price))}),e}},t.prototype.countCart=function(){return this.basket.length},t.prototype.updateCartTotalAndCount=function(){if(this.mapCart(),this.cartTotal=this.totalCart(),this.cartCount=this.countCart(),0<this.cartCount){document.getElementById("cart").style.height="75px";var t="";2<=this.cartCount?t+="<p>"+this.cartCount+" items<br />":t+="<p>"+this.cartCount+" item<br />",t+="Total: $"+this.numberWithCommas(this.cartTotal)+"</p>",document.getElementById("cartLeft").innerHTML=t}else document.getElementById("cart").style.height="0"},t.prototype.makeCartInBrowser=function(){var n=this;document.body.insertAdjacentHTML("beforeend",'<div id="cart">\n                    <div>\n                        <div id="cartLeft"></div>\n                        <div id="cartRight">\n                            <a id="viewCart" class="button">View Cart</a>\n                        </div>\n                    </div>\n                </div>'),document.getElementById("viewCart").addEventListener("click",function(t){var e=n.listCart();0<n.cartTotal?(n.modal.openOverlay(e),n.wireUpCartDeletes(),n.wireUpCartCheckoutBtn(),t.preventDefault()):n.modal.closeOverlay(document.getElementById(n.modal.overlayContainerGuts),document.getElementById(n.modal.overlayContainerID),window.scrollY)})},t.prototype.wireUpCartCheckoutBtn=function(){var t=this;document.getElementById("checkoutNow").addEventListener("click",function(r){return __awaiter(t,void 0,void 0,function(){var e,n,i;return __generator(this,function(t){switch(t.label){case 0:return r.preventDefault(),[4,this.makeCheckoutURL()];case 1:return e=t.sent(),this.basket=[],[4,this.mapCart()];case 2:return t.sent(),[4,this.cookie.deleteCookie()];case 3:return t.sent(),[4,this.updateCartTotalAndCount()];case 4:for(t.sent(),n=document.getElementsByClassName("atcBtn"),i=0;i<n.length;i++)n[i].classList.remove("onCart");return this.modal.isOpen?[4,this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)]:[3,6];case 5:t.sent(),t.label=6;case 6:return r.target.href=e,window.location=e,[2]}})})})},t.prototype.wireUpCartDeletes=function(){var i=this;if(0<this.countCart()){var t=document.getElementsByClassName("crDeleteBtn"),e=document.getElementsByClassName("crDeleteEmbed");if(0<t.length)for(var n=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");i.addOrRemoveFromCart(i.basket[e]),i.modal.updateOverlayContent(i.listCart()),i.wireUpCartDeletes(),t.preventDefault()})},r=0,o=t;r<o.length;r++){n(o[r])}if(0<e.length)for(var a=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");i.addOrRemoveFromCart(i.basket[e]),i.modal.updateOverlayContent(i.listCart()),i.wireUpCartDeletes(),t.preventDefault()})},s=0,l=e;s<l.length;s++){a(l[s])}}else this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)},t.prototype.listCart=function(){var n=this;if(this.cartCount=this.countCart(),0<this.cartCount){var i='<div id="cartList">';return this.basket.forEach(function(t,e){i+='<div class="cartRow">\n                    <div class="crImg">',"/"!=t.image&&(i+='<img src="https://feinberg-dev.fsm.northwestern.edu/it-new/'+t.image+'" alt="'+t.title+'-image" />'),i+='</div>\n                    <div class="crDesc">\n                        <p>'+t.title,!t.catStr.includes("software")||t.renew&&(i+=" - Renewing"),i+='</p>\n                        <a class="crDeleteEmbed" data-basket-position="'+e+'" >Delete</a>\n                    </div>\n                    <div class="crDelete"> \n                        <p><a class="crDeleteBtn" data-basket-position="'+e+'" href="">Delete</a></p>\n                    </div>\n                    <div><p>$'+n.numberWithCommas(t.price,!1)+"</p></div>\n                </div>"}),i+='\n                <div class="cartRow">\n                    <div class="crImg">&nbsp;</div>\n                    <div class="crDesc">&nbsp;</div>\n                    <div class="crDelete">Total:</div>\n                    <div>$'+this.numberWithCommas(this.totalCart(),!0)+'</div>\n                </div>\n                <div class="cartRow">\n                    <div class="checkoutRow">\n                        <a id="checkoutNow" href="#" class="button">Checkout Now</a> \n                    </div>\n                </div>\n            ',i+="</div>"}},t.prototype.toggleATCbutton=function(t,e){e?(t.classList.add("onCart"),t.textContent=this.cartBtnTxt.Remove):(t.classList.remove("onCart"),t.textContent=this.cartBtnTxt.Add),t.blur()},t.prototype.numberWithCommas=function(t,e){return void 0===e&&(e=!0),e?t.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.prototype.makeCheckoutURL=function(){if(0<this.basket.length){for(var t=this.machformBase+"&",e=0;e<this.basket.length;e++)this.basket[e].catStr.includes("software")&&this.basket[e].renew?t+=this.basket[e].renewElement+"=1":t+=this.basket[e].element+"=1",e+1<this.basket.length&&(t+="&");return t}return null},t}(),Store=function(){function t(t,e,n,i,r){this.apiURL="https://feinberg-dev.fsm.northwestern.edu/it-new/ws/json-api.php",this.items=[{}],this.modal=n,this.cookie=i,this.softwareCookie=r,this.cart=e,this.containerEL=document.getElementById(t),this.wireUpAddToCartClicks()}return t.prototype.wireUpAddToCartClicks=function(){for(var a=this,t=function(r){r.addEventListener("click",function(t){t.preventDefault();var e=r.getAttribute("data-num"),n=a.items[e].outputOverlay(e);a.modal.openOverlay(n);var i=document.getElementById("atcModalBtn");null!=i&&i.addEventListener("click",function(t){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.addToCartToggle(e,i)];case 1:return t.sent(),this.items[e].catStr.includes("software")&&this.cart.toggleSoftwareSelects(this.items[e].id),this.cart.mapCart(),this.cart.mappedBasket.includes(this.items[e].id)?this.cart.toggleATCbutton(r.getElementsByClassName("atcBtn")[0],!0):this.cart.toggleATCbutton(r.getElementsByClassName("atcBtn")[0],!1),[2]}})})})})},e=0,n=document.getElementsByClassName("prodBox");e<n.length;e++){t(n[e])}for(var i=function(o){o.addEventListener("click",function(t){var e=o.getAttribute("data-num");if("0.00"!=a.items[e].price){if(a.items[e].categories.value.includes("software")){var n=document.querySelector('article[data-id="'+a.items[e].id+'"] select.renewInput'),i=n.options[n.selectedIndex].value;a.items[e].renew="renew"==i}a.addToCartToggle(e,o),t.preventDefault(),t.stopPropagation()}else{var r=a.items[e].outputOverlay(e);a.modal.openOverlay(r),t.preventDefault(),t.stopPropagation()}})},r=0,o=document.getElementsByClassName("atcBtn");r<o.length;r++){i(o[r])}for(var s=0,l=document.getElementsByClassName("renewInput");s<l.length;s++)l[s]},t.prototype.addToCartToggle=function(t,e){this.cart.addOrRemoveFromCart(this.items[t])?(this.items[t].onCart=!0,this.cart.toggleATCbutton(e,!0)):(this.items[t].onCart=!1,this.cart.toggleATCbutton(e,!1),this.items[t].renew=!1)},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t}(),Cookie=function(){function t(t){this.name=t}return t.prototype.setCookie=function(t,e){var n=new Date;n.setTime(n.getTime()+864e5*e),document.cookie=this.name+"="+t+";path=/;expires="+n.toUTCString()},t.prototype.getCookie=function(){var t=document.cookie.match("(^|;) ?"+this.name+"=([^;]*)(;|$)");return t?t[2]:null},t.prototype.getJSONfromCookieAsArray=function(){var t=JSON.parse(this.getCookie());return t||[]},t.prototype.deleteCookie=function(){this.setCookie("",-1)},t}(),itAlert=function(){function t(t,e){this.hasAlerts={either:!1,homepageAlert:!1,purchasingAlert:!1},this.modal=t,this.getAlerts(),"purchasing"==e?(this.baseEL=document.getElementById("main-content"),this.type="purchasing"):(this.baseEL=document.getElementById("homepageContent"),this.type="homepage")}return t.prototype.chooseColor=function(t){return"Red"==t?" itDanger ":" itPrimary "},t.prototype.buildBox=function(t){var e='<div class="contain-1440 itAlert '+this.chooseColor(t.color)+' ">\n                    <div class="contain-1120">\n                    \x3c!-- <i class="fa fa-exclamation-triangle fa-2x">&nbsp;</i> --\x3e\n                    <h3>'+t.title+"</h3>\n                    <p>"+t.blurb+"</p>";return void 0!==t.modal&&(e+='<p><a id="alertTrigger" href="#">Read more</a></p>'),e+="</div>  \n                </div>",console.log("inside:",e),e},t.prototype.buildModalGuts=function(t){return'<div class="bootstrap-wrapper"> \n                    <div class="container">\n                        <div class="row alertRow">\n                            <div class="col-12">'+t.modal+"</div>\n                        </div>\n                    </div>\n                </div>"},t.prototype.addAlertBoxToPage=function(){var e=this.modal,n="";if("homepage"==this.type){var t=this.buildBox(this.alerts.homepageAlert);""!=this.alerts.homepageAlert.modal&&(n=this.buildModalGuts(this.alerts.homepageAlert)),this.baseEL.insertAdjacentHTML("afterbegin",t)}else{console.log("Before: ",this.alerts.purchasingAlert);t=this.buildBox(this.alerts.purchasingAlert);""!=this.alerts.purchasingAlert.modal&&(n=this.buildModalGuts(this.alerts.purchasingAlert)),this.baseEL.querySelector("h1:first-of-type").insertAdjacentHTML("afterend","<section>"+t+"</section>")}""==n||document.getElementById("alertTrigger")&&(this.trigger=document.getElementById("alertTrigger"),this.trigger.addEventListener("click",function(t){e.openOverlay(n),t.preventDefault()}))},t.prototype.getAlerts=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,fetch("https://feinberg-dev.fsm.northwestern.edu/it-new/ws/json-api.php?type=alerts").then(function(t){return t.json()}).then(function(t){return t})];case 1:return!(e=t.sent()).homepageAlert||"homepage"==this.type&&(this.hasAlerts.either=this.hasAlerts.homepageAlert=!0),!e.purchasingAlert||"purchasing"==this.type&&(this.hasAlerts.either=this.hasAlerts.purchasingAlert=!0),this.hasAlerts&&(this.alerts=e,this.hasAlerts.either&&this.addAlertBoxToPage()),[2]}})})},t}();window.onload=function(){var t=new Cookie("fsmITPurchasing"),e=new Cookie("fsmITPurchasingSoftware"),n=new Modal,i=new Cart(n,t,e);new Store("shopping-cart",i,n,t,e),new itAlert(n,"purchasing")};