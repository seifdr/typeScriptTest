"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var __awaiter=function(a,r,s,l){return new(s||(s=Promise))(function(t,e){function n(t){try{i(l.next(t))}catch(t){e(t)}}function o(t){try{i(l.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,o)}i((l=l.apply(a,r||[])).next())})},__generator=function(n,o){var i,a,r,t,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,a&&(r=2&e[0]?a.return:e[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,e[1])).done)return r;switch(a=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,a=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){s.label=e[1];break}if(6===e[0]&&s.label<r[1]){s.label=r[1],r=e;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(e);break}r[2]&&s.ops.pop(),s.trys.pop();continue}e=o.call(n,s)}catch(t){e=[6,t],a=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};function removeSpecialChars(t){return t.replace(/[`~!@#$%^&*()_|+\-=?;:'",<>\{\}\[\]\\\/]/gi,"")}var Item=function(){function t(t){this.id=t.id,this.title=t.title,this.element=t.element,this.renewElement=t.renewElement,this.type=t.type,this.categories=t.categories;var e=removeSpecialChars(t.price);isNaN(e)?t.price=0:this.price=removeSpecialChars(e),this.image=t.image.path,this.desc=t.desc,this.onCart=!!t.onCart,this.renew=!!t.renew}return t.prototype.outputOverlay=function(t){void 0===t&&(t=null);var e=this.onCart?"Remove From Cart":"Add To Cart",n=this.onCart?"onCart":"",o='\n            <div id="overlayPad">\n                <div class="overlayImg">\n                    <img src="https://feinberg-dev.fsm.northwestern.edu/it-new/'+this.image+'" />\n                </div>\n                <div class="overlayText">\n                    <h3>'+this.title+"</h3>";return"0.00"!=this.price&&(o+="<h6>$"+this.numberWithCommas(this.price)+"</h6>"),"string"==typeof this.desc?o+="<div>"+this.desc+"</div><br />":o+="<br />","0.00"!=this.price&&(o+='<a id="atcModalBtn" class="button '+n+'" href="#" data-num="'+t+'" >'+e+"</a>"),o+="</div>\n            </div>"},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t}(),Cart=function(){function t(t,e,n){this.machformBase="https://forms.feinberg.northwestern.edu/view.php?id=48491",this.basket=[],this.mappedBasket=[],this.softwareAltIds=[],this.cartCount=0,this.cartTotal=0,this.cartBtnTxt={Add:"Add To Cart",Remove:"Remove From Cart",Info:"More Info"},this.modal=t,this.cookie=e,this.softwareCookie=n,this.makeCartInBrowser()}return t.prototype.mapCart=function(){if(this.mappedBasket=this.basket.map(function(t){return t.id}),this.softwareAltIds=this.basket.map(function(t){if(t.renew)return t.id}),0<this.mappedBasket.length){var t=JSON.stringify(this.mappedBasket);if(this.cookie.setCookie(t,1),0<this.softwareAltIds.length){var e=JSON.stringify(this.mappedBasket);this.softwareCookie.setCookie(e,1)}else this.softwareCookie.deleteCookie()}else this.cookie.deleteCookie(),this.softwareCookie.deleteCookie()},t.prototype.addOrRemoveFromCart=function(n){var o;if(0<this.basket.length){if(this.basket.forEach(function(t,e){t.id===n.id&&(o=e)}),console.log(o),-1===o||void 0===o){var t=this.addToBasket(n);return this.updateCartTotalAndCount(),t}for(var e=this.removeFromBasket(o)[0],i=document.getElementsByClassName("atcBtn"),a=0;a<i.length;a++){var r=i[a].getAttribute("data-id");e.id==r&&this.toggleATCbutton(i[a],!1)}return this.updateCartTotalAndCount(),!1}if(null!=n.id||null!=n.id){t=this.addToBasket(n);return this.updateCartTotalAndCount(),t}},t.prototype.addToBasket=function(t){return this.basket.push(t),console.log("Basket: ",this.basket),!0},t.prototype.removeFromBasket=function(t){return console.log("Removing this: ",t),this.basket.splice(t,1)},t.prototype.inBasket=function(n){this.basket.forEach(function(t,e){return t.id===n&&e})},t.prototype.totalCart=function(){if(0<this.basket.length){var e=0;return this.basket.forEach(function(t){e+=parseFloat(removeSpecialChars(t.price))}),e}},t.prototype.countCart=function(){return console.log("Cart count: ",this.cartCount),this.basket.length},t.prototype.updateCartTotalAndCount=function(){if(this.mapCart(),this.cartTotal=this.totalCart(),this.cartCount=this.countCart(),0<this.cartCount){document.getElementById("cart").style.height="75px";var t="";console.log("Cart Count: ",this.cartCount),2<=this.cartCount?t+="<p>"+this.cartCount+" items<br />":t+="<p>"+this.cartCount+" item<br />",t+="Total: $"+this.numberWithCommas(this.cartTotal)+"</p>",document.getElementById("cartLeft").innerHTML=t}else document.getElementById("cart").style.height="0"},t.prototype.makeCartInBrowser=function(){var n=this;document.body.insertAdjacentHTML("beforeend",'<div id="cart">\n                    <div>\n                        <div id="cartLeft"></div>\n                        <div id="cartRight">\n                            <a id="viewCart" class="button">View Cart</a>\n                        </div>\n                    </div>\n                </div>'),document.getElementById("viewCart").addEventListener("click",function(t){var e=n.listCart();0<n.cartTotal?(n.modal.openOverlay(e),n.wireUpCartDeletes(),n.wireUpCartCheckoutBtn(),t.preventDefault()):n.modal.closeOverlay(document.getElementById(n.modal.overlayContainerGuts),document.getElementById(n.modal.overlayContainerID),window.scrollY)})},t.prototype.wireUpCartCheckoutBtn=function(){var t=this;document.getElementById("checkoutNow").addEventListener("click",function(i){return __awaiter(t,void 0,void 0,function(){var e,n,o;return __generator(this,function(t){switch(t.label){case 0:return i.preventDefault(),[4,this.makeCheckoutURL()];case 1:return e=t.sent(),this.basket=[],[4,this.mapCart()];case 2:return t.sent(),[4,this.cookie.deleteCookie()];case 3:return t.sent(),[4,this.updateCartTotalAndCount()];case 4:for(t.sent(),n=document.getElementsByClassName("atcBtn"),o=0;o<n.length;o++)n[o].classList.remove("onCart");return this.modal.isOpen?[4,this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)]:[3,6];case 5:t.sent(),t.label=6;case 6:return i.target.href=e,window.location=e,[2]}})})})},t.prototype.wireUpCartDeletes=function(){var o=this;if(0<this.countCart()){var t=document.getElementsByClassName("crDeleteBtn"),e=document.getElementsByClassName("crDeleteEmbed");if(0<t.length)for(var n=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");o.addOrRemoveFromCart(o.basket[e]),o.modal.updateOverlayContent(o.listCart()),o.wireUpCartDeletes(),t.preventDefault()})},i=0,a=t;i<a.length;i++){n(a[i])}if(0<e.length)for(var r=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");o.addOrRemoveFromCart(o.basket[e]),o.modal.updateOverlayContent(o.listCart()),o.wireUpCartDeletes(),t.preventDefault()})},s=0,l=e;s<l.length;s++){r(l[s])}}else this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)},t.prototype.listCart=function(){var n=this;if(this.cartCount=this.countCart(),0<this.cartCount){var o='<div id="cartList">';return this.basket.forEach(function(t,e){console.log(t.image),o+='<div class="cartRow">\n                    <div class="crImg">',"/"!=t.image&&(o+='<img src="https://feinberg-dev.fsm.northwestern.edu/it-new/'+t.image+'" alt="'+t.title+'-image" />'),o+='</div>\n                    <div class="crDesc">\n                        <p>'+t.title+'</p>\n                        <a class="crDeleteEmbed" data-basket-position="'+e+'" >Delete</a>\n                    </div>\n                    <div class="crDelete"> \n                        <p><a class="crDeleteBtn" data-basket-position="'+e+'" href="">Delete</a></p>\n                    </div>\n                    <div><p>$'+n.numberWithCommas(t.price,!1)+"</p></div>\n                </div>"}),o+='\n                <div class="cartRow">\n                    <div class="crImg">&nbsp;</div>\n                    <div class="crDesc">&nbsp;</div>\n                    <div class="crDelete">Total:</div>\n                    <div>$'+this.numberWithCommas(this.totalCart(),!0)+'</div>\n                </div>\n                <div class="cartRow">\n                    <div class="checkoutRow">\n                        <a id="checkoutNow" href="#" class="button">Checkout Now</a> \n                    </div>\n                </div>\n            ',o+="</div>"}},t.prototype.toggleATCbutton=function(t,e){e?(t.classList.add("onCart"),t.textContent=this.cartBtnTxt.Remove):(t.classList.remove("onCart"),t.textContent=this.cartBtnTxt.Add),t.blur()},t.prototype.numberWithCommas=function(t,e){return void 0===e&&(e=!0),e?t.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.prototype.makeCheckoutURL=function(){if(0<this.basket.length){for(var t=this.machformBase+"&",e=0;e<this.basket.length;e++)t+=this.basket[e].element+"=1",e+1<this.basket.length&&(t+="&");return t}return null},t}(),Store=function(){function t(t,e,n,o,i){this.apiURL="https://feinberg-dev.fsm.northwestern.edu/it-new/ws/purchasing-api.php",this.items=[{}],this.modal=n,this.cookie=o,this.softwareCookie=i,this.cart=e,this.containerEL=document.getElementById(t),this.stockTheShelves()}return t.prototype.loadProducts=function(){var n=this,o=this.cookie.getJSONfromCookieAsArray(),i=this.softwareCookie.getJSONfromCookieAsArray();return fetch(this.apiURL).then(function(t){return t.json()}).then(function(t){return 0<t.items.length&&(t.items.forEach(function(t,e){0<o.length&&(o.includes(t.id)?(t.onCart=!0,i.includes(t.id)&&(t.renew=!0),n.cart.addOrRemoveFromCart(new Item(t))):t.onCart=!1),n.items[e]=new Item(t)}),!0)})},t.prototype.stockTheShelves=function(){return __awaiter(this,void 0,void 0,function(){var a,e,n,o,i,r,s,l,c,d,u,p,h,m,v,f=this;return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadProducts()];case 1:if(t.sent()){for(a='<div class="bootstrap-wrapper">\n                            <div class="container-fluid">\n                                <section id="filterChecks">\n                                    <form class="row">\n                                        <div class="col-6">\n                                                <label>Filter by Category:</label>\n                                                <select id="filterCat" class="filterOptions">\n                                                    <option value="all">Show All</option>\n                                                    <option value="bundles">Bundles</option>\n                                                    <option value="desktops">Desktops</option>\n                                                    <option value="laptops">Laptops</option>\n                                                    <option value="monitors">Monitors</option>\n                                                    <option value="apple desktops">Apple Desktops</option>\n                                                    <option value="apple laptops">Apple Laptops</option>\n                                                    <option value="ipads">iPads</option>\n                                                    <option value="tablets">Tablets</option>\n                                                    <option value="printers">Printers</option>\n                                                    <option value="software">Software</option>\n                                                    <option value="accessories">Peripheral Accessories</option>\n                                                </select>\n                                        </div>\n                                        <div class="col-6">\n                                            <label>Filter by OS:</label>\n                                            <select id="filterOS" class="filterOptions">\n                                                <option value="all">Show All</option>\n                                                <option value="apple">Apple</option>\n                                                <option value="pc">PC</option>\n                                            </select>\n                                        </div>   \n                                    </form>\n                                </section>\n                                <section class="shelves"><div class="row">',this.items.forEach(function(t,e){var n="";"object"==_typeof(t.categories.value)?t.categories.value.forEach(function(t){t&&(n=n+""+t+" ")}):n=t.categories.value;var o=0==t.price?"":"$"+f.numberWithCommas(t.price),i=0==t.price?f.cart.cartBtnTxt.Info:f.cart.cartBtnTxt.Add;a+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 pbc" data-os="'+t.type+'" data-catString="'+n+'"><article class="feature-box prodBox" data-id="'+t.id+'" data-num="'+e+'" >',"/"!=t.image&&(a+='<div class="img-container">\n                                        <img class="img-fluid" src="https://feinberg-dev.fsm.northwestern.edu/it-new/'+t.image+'" alt="'+t.title+'-image" />\n                                    </div>'),a+='<div class="feature-copy">\n                                        <div>\n                                            <h6>'+t.title+"</h6>\n                                            <p>"+o+'</p>\n                                            <a class="specs" data-id="'+t.id+'">Read product specs</a>\n                                        </div>',"software"==n&&(a+='<div class="renewSelect">\n                                                        <label>Purchase or Renew\n                                                        Software Licence: </label>\n                                                        <select class="renewInput">\n                                                            <option value="new">New</option>\n                                                            <option value="renew" ',!n.includes("software")||t.renew&&(a+=' selected="selected" '),a+=">Renew</option></select></div>"),a+="</div>",a+='<a class="button atcBtn',t.onCart&&(a+=" onCart ",i=f.cart.cartBtnTxt.Remove),a+=' " data-num="'+e+'" data-id="'+t.id+'" data-isCartBtn="true" href="#">'+i+"</a></article></div>"}),a+="</div></section>\n                            </div></div>",this.containerEL.insertAdjacentHTML("beforeend",a),e=function(i){i.addEventListener("click",function(t){t.preventDefault();var e=i.getAttribute("data-num"),n=f.items[e].outputOverlay(e);f.modal.openOverlay(n);var o=document.getElementById("atcModalBtn");null!=o&&o.addEventListener("click",function(t){f.addToCartToggle(e,o),f.cart.mapCart(),f.cart.mappedBasket.includes(f.items[e].id)?f.cart.toggleATCbutton(i.getElementsByClassName("atcBtn")[0],!0):f.cart.toggleATCbutton(i.getElementsByClassName("atcBtn")[0],!1)})})},n=0,o=document.getElementsByClassName("prodBox");n<o.length;n++)i=o[n],e(i);for(r=function(a){a.addEventListener("click",function(t){var e=a.getAttribute("data-num");if("0.00"!=f.items[e].price){if(f.items[e].categories.value.includes("software")){var n=document.querySelector('article[data-id="'+f.items[e].id+'"] select.renewInput'),o=n.options[n.selectedIndex].value;f.items[e].renew="renew"==o}f.addToCartToggle(e,a),t.preventDefault(),t.stopPropagation()}else{var i=f.items[e].outputOverlay(e);f.modal.openOverlay(i),t.preventDefault(),t.stopPropagation()}})},s=0,l=document.getElementsByClassName("atcBtn");s<l.length;s++)c=l[s],r(c);for(d=function(e){e.addEventListener("click",function(t){e.options[v.selectedIndex].value;t.preventDefault(),t.stopPropagation()})},u=0,p=document.getElementsByClassName("renewInput");u<p.length;u++)h=p[u],d(h);m=document.getElementById("filterCat"),v=document.getElementById("filterOS"),m.addEventListener("change",function(t){f.filterShelves(m,v)}),v.addEventListener("change",function(t){f.filterShelves(m,v)})}return[2]}})})},t.prototype.addToCartToggle=function(t,e){var n=this.cart.addOrRemoveFromCart(this.items[t]);alert("hello"),n?(this.items[t].onCart=!0,this.cart.toggleATCbutton(e,!0)):(this.items[t].onCart=!1,this.cart.toggleATCbutton(e,!1))},t.prototype.filterShelves=function(t,e){var n=document.getElementsByClassName("pbc"),o=t.options[t.selectedIndex].value,i=e.options[e.selectedIndex].value;console.log("Selected OS: ",i),this.showAllProducts(n),"all"!=o?this.hideShowProducts(n,o,i):"all"!=i?this.hideShowProducts(n,o,i):this.showAllProducts(n)},t.prototype.hideShowProducts=function(t,e,n){for(var o=0;o<t.length;o++){var i=t[o],a=i.getAttribute("data-catString"),r=i.getAttribute("data-os");"all"==e||a.includes(e)||(i.style.display="none"),"all"==n||r.includes(n)||(i.style.display="none")}},t.prototype.showAllProducts=function(t){for(var e=0;e<t.length;e++){t[e].style.display="flex"}},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t}(),Modal=function(){function t(){this.overlayContainerID="overlay",this.overlayContainerGuts="overlayGuts",this.isOpen=!1,this.addOverlay()}return t.prototype.addOverlay=function(){document.getElementById("main-content").insertAdjacentHTML("beforeend",'<div id="overlay"><div id="overlay-content"><a class="closebtn"><i class="fa fa-times"> </i></a><div id="overlayGuts" class="col1of1 responsive-container"></div></div></div>')},t.prototype.updateOverlayContent=function(t){document.getElementById(this.overlayContainerGuts).innerHTML=t},t.prototype.openOverlay=function(t){var e=this,n=window.scrollY;window.scroll(0,n);var o=document.getElementById(this.overlayContainerID),i=document.getElementById(this.overlayContainerGuts);this.updateOverlayContent(t),o.style.height="100%",o.style.display="block",document.body.classList.add("modal-open"),o.getElementsByClassName("closebtn")[0].addEventListener("click",function(t){e.closeOverlay(i,o,n),t.preventDefault()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&(e.closeOverlay(i,o,n),t.preventDefault())}),this.isOpen=!0},t.prototype.closeOverlay=function(t,e,n){t.innerHTML="",e.style.height="0%",e.style.display="none",document.body.classList.remove("modal-open"),window.scroll(0,n),this.isOpen=!1},t}(),Cookie=function(){function t(t){this.name=t}return t.prototype.setCookie=function(t,e){var n=new Date;n.setTime(n.getTime()+864e5*e),document.cookie=this.name+"="+t+";path=/;expires="+n.toUTCString()},t.prototype.getCookie=function(){var t=document.cookie.match("(^|;) ?"+this.name+"=([^;]*)(;|$)");return t?t[2]:null},t.prototype.getJSONfromCookieAsArray=function(){var t=JSON.parse(this.getCookie());return t||[]},t.prototype.deleteCookie=function(){this.setCookie("",-1)},t}();window.onload=function(){var t=new Cookie("fsmITPurchasing"),e=new Cookie("fsmITPurchasingSoftware"),n=new Modal,o=new Cart(n,t,e);new Store("shopping-cart",o,n,t,e);console.log(e.getJSONfromCookieAsArray())};