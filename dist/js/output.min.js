"use strict";var __awaiter=function(t,o,s,l){return new(s||(s=Promise))(function(e,n){function i(t){try{a(l.next(t))}catch(t){n(t)}}function r(t){try{a(l.throw(t))}catch(t){n(t)}}function a(t){t.done?e(t.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(t.value).then(i,r)}a((l=l.apply(t,o||[])).next())})},__generator=function(n,i){var r,a,o,t,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(o=2&e[0]?a.return:e[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,e[1])).done)return o;switch(a=0,o&&(e=[2&e[0],o.value]),e[0]){case 0:case 1:o=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,a=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!o||e[1]>o[0]&&e[1]<o[3])){s.label=e[1];break}if(6===e[0]&&s.label<o[1]){s.label=o[1],o=e;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(e);break}o[2]&&s.ops.pop(),s.trys.pop();continue}e=i.call(n,s)}catch(t){e=[6,t],a=0}finally{r=o=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},Modal=function(){function t(){this.overlayContainerID="overlay",this.overlayContainerGuts="overlayGuts",this.isOpen=!1,this.addOverlay()}return t.prototype.addOverlay=function(){document.body.insertAdjacentHTML("beforeend",'<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">\n        <div class="modal-dialog">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title" id="exampleModalLabel">New message</h5>\n              <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n              </button>\n            </div>\n            <div class="modal-body">\n              <form>\n                <div class="form-group">\n                  <label for="recipient-name" class="col-form-label">Recipient:</label>\n                  <input type="text" class="form-control" id="recipient-name">\n                </div>\n                <div class="form-group">\n                  <label for="message-text" class="col-form-label">Message:</label>\n                  <textarea class="form-control" id="message-text"></textarea>\n                </div>\n              </form>\n            </div>\n            <div class="modal-footer">\n              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n              <button type="button" class="btn btn-primary">Send message</button>\n            </div>\n          </div>\n        </div>\n      </div>')},t.prototype.updateOverlayContent=function(t){document.getElementById(this.overlayContainerGuts).innerHTML=t},t.prototype.openOverlay=function(t){var e=this,n=window.scrollY;window.scroll(0,n);var i=document.getElementById(this.overlayContainerID),r=document.getElementById(this.overlayContainerGuts);this.updateOverlayContent(t),i.style.height="100%",i.style.display="block",document.body.classList.add("modal-open"),i.getElementsByClassName("closebtn")[0].addEventListener("click",function(t){e.closeOverlay(r,i,n),t.preventDefault()}),document.addEventListener("keydown",function(t){"Escape"===t.key&&(e.closeOverlay(r,i,n),t.preventDefault())}),this.isOpen=!0},t.prototype.closeOverlay=function(t,e,n){t.innerHTML="",e.style.height="0%",e.style.display="none",document.body.classList.remove("modal-open"),window.scroll(0,n),this.isOpen=!1},t}();function removeSpecialChars(t){return t.toString().replace(/[`~!@#$%^&*()_|+\-=?;:'",<>\{\}\[\]\\\/]/gi,"")}var Item=function(){function t(t){this.position=t.position,this.id=t.id,this.title=t.title,this.element=t.element,this.renewElement=t.renewElement,this.type=t.type,this.software=t.software;var e=removeSpecialChars(t.price);isNaN(e)?t.price=0:this.price=removeSpecialChars(e),this.image=t.image,this.desc=t.desc,this.onCart=!!t.onCart,this.renew=!!t.renew}return t.prototype.outputOverlay=function(t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var n=e?"Remove From Cart":"Add To Cart",i=e?"onCart":"",r='<div id="overlayPad" data-id="'+this.id+'" >\n        <div class="bootstrap-wrapper">\n    <div class="container">\n    <div class="row">';return"/"!=this.image&&(r+='<div class="col-12 col-lg-6 overlayImg">\n                        <div>',this.image&&""!=this.image?r+='<img src="'+this.image+'" />':r+="&nbsp;",r+="</div>\n                    </div>"),r+='<div class="col-12 col-lg-6 overlayText">\n                        \n                            <h3>{this.title}',!this.software||this.renew&&(r+=" - Renewing"),r+="</h3>\n                        ","0.00"!=this.price&&"0"!=this.price&&""!=this.price&&(r+="<h6>$"+this.numberWithCommas(this.price)+"</h6>"),"string"==typeof this.desc?r+="<div>"+this.desc+"</div><br />":r+="<br />","0.00"!=this.price&&"0"!=this.price&&""!=this.price&&(this.software&&(r+='<div class="renewModalSelect">\n                    <label>Purchase or Renew\n                    Software Licence: </label>\n                    <select class="renewModalInput" data-id="'+this.id+'" ',this.onCart&&(r+=" disabled "),r+='>\n                        <option value="new">New</option>\n                        <option value="renew" ',this.renew&&(r+=' selected="selected" '),r+=">Renew</option></select>",r+="</div>"),r+='<a id="atcModalBtn" href="#" \n                            class="button '+i+'" \n                            data-position="'+t+'" \n                            data-id="'+this.id+'"\n                            data-is-software="{'+this.software+'}"   \n                        >'+n+"</a>"),r+="</div>\n            </div>\n            </div>\n            </div>\n        </div>"},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t}(),Cart=function(){function t(t,e,n){this.machformBase="https://forms.feinberg.northwestern.edu/view.php?id=48491",this.basket=[],this.mappedBasket=[],this.softwareAltIds=[],this.cartCount=0,this.cartTotal=0,this.cartBtnTxt={Add:"Add To Cart",Remove:"Remove From Cart",Info:"More Info"},this.modal=t,this.cookie=e,this.softwareCookie=n,this.makeCartInBrowser()}return t.prototype.mapCart=function(){if(this.mappedBasket=this.basket.map(function(t){return t.id}),this.softwareAltIds=this.basket.map(function(t){if(t.renew)return t.id}),0<this.mappedBasket.length){var t=JSON.stringify(this.mappedBasket);if(this.cookie.setCookie(t,1),0<this.softwareAltIds.length){var e=JSON.stringify(this.mappedBasket);this.softwareCookie.setCookie(e,1)}else this.softwareCookie.deleteCookie()}else this.cookie.deleteCookie(),this.softwareCookie.deleteCookie()},t.prototype.addOrRemoveFromCart=function(n){var i;if(0<this.basket.length){this.basket.forEach(function(t,e){t.id===n.id&&(i=e)});var t=document.querySelector('article.prodBox[data-num="'+n.id+'"] > a.atcBtn');if(-1===i||void 0===i){var e=this.addToBasket(n);return this.toggleATCbutton(t,!0),e&&this.toggleSoftwareSelects(n.id),this.updateCartTotalAndCount(),e}var r=this.removeFromBasket(i)[0];this.toggleATCbutton(t,!1);for(var a=document.getElementsByClassName("atcBtn"),o=0;o<a.length;o++){var s=a[o].getAttribute("data-num");r.id==s&&(this.toggleATCbutton(a[o],!1),this.toggleSoftwareSelects(s))}return this.updateCartTotalAndCount(),!1}if(null!=n.id||null!=n.id)return(e=this.addToBasket(n))&&this.toggleSoftwareSelects(n.id),this.updateCartTotalAndCount(),e},t.prototype.toggleSoftwareSelects=function(t){if(t){var e=document.querySelectorAll('select[data-num="'+t+'"]');-1!=this.inBasket(t)?e.forEach(function(t){t.setAttribute("disabled","disabled")}):e.forEach(function(t){t.removeAttribute("disabled")})}},t.prototype.addToBasket=function(t){return this.basket.push(t),!0},t.prototype.removeFromBasket=function(t){return this.basket.splice(t,1)},t.prototype.itemInBasket=function(t){return this.mapCart(),this.mappedBasket.includes(t)},t.prototype.inBasket=function(n){var i=-1;return this.basket.forEach(function(t,e){t.id===n&&(i=e)}),i},t.prototype.totalCart=function(){if(0<this.basket.length){var e=0;return this.basket.forEach(function(t){e+=parseFloat(removeSpecialChars(t.price))}),e}},t.prototype.countCart=function(){return this.basket.length},t.prototype.updateCartTotalAndCount=function(){if(this.mapCart(),this.cartTotal=this.totalCart(),this.cartCount=this.countCart(),0<this.cartCount){document.getElementById("cart").style.height="75px";var t="";2<=this.cartCount?t+="<p>"+this.cartCount+" items<br />":t+="<p>"+this.cartCount+" item<br />",t+="Total: $"+this.numberWithCommas(this.cartTotal)+"</p>",document.getElementById("cartLeft").innerHTML=t}else document.getElementById("cart").style.height="0"},t.prototype.makeCartInBrowser=function(){var n=this;document.body.insertAdjacentHTML("beforeend",'<div id="cart">\n                    <div>\n                        <div id="cartLeft"></div>\n                        <div id="cartRight">\n                            <a id="viewCart" class="button">View Cart</a>\n                        </div>\n                    </div>\n                </div>'),document.getElementById("viewCart").addEventListener("click",function(t){var e=n.listCart();0<n.cartTotal?(n.modal.openOverlay(e),n.wireUpCartDeletes(),n.wireUpCartCheckoutBtn(),t.preventDefault()):n.modal.closeOverlay(document.getElementById(n.modal.overlayContainerGuts),document.getElementById(n.modal.overlayContainerID),window.scrollY)})},t.prototype.wireUpCartCheckoutBtn=function(){var t=this;document.getElementById("checkoutNow").addEventListener("click",function(a){return __awaiter(t,void 0,void 0,function(){var e,n,i,r;return __generator(this,function(t){switch(t.label){case 0:return a.preventDefault(),[4,this.makeCheckoutURL()];case 1:return e=t.sent(),this.basket=[],[4,this.mapCart()];case 2:return t.sent(),[4,this.cookie.deleteCookie()];case 3:return t.sent(),[4,this.updateCartTotalAndCount()];case 4:for(t.sent(),n=document.getElementsByClassName("atcBtn"),r=0;r<n.length;r++)this.toggleATCbutton(n[r],!1);for(i=document.getElementsByClassName("renewInput"),r=0;r<i.length;r++)i[r].value="new";return this.modal.isOpen?[4,this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)]:[3,6];case 5:t.sent(),t.label=6;case 6:return a.target.href=e,window.location=e,[2]}})})})},t.prototype.wireUpCartDeletes=function(){var i=this;if(0<this.countCart()){var t=document.getElementsByClassName("crDeleteBtn"),e=document.getElementsByClassName("crDeleteEmbed");if(0<t.length)for(var n=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");i.addOrRemoveFromCart(i.basket[e]),i.modal.updateOverlayContent(i.listCart()),i.wireUpCartDeletes(),t.preventDefault()})},r=0,a=t;r<a.length;r++){n(a[r])}if(0<e.length)for(var o=function(n){n.addEventListener("click",function(t){var e=n.getAttribute("data-basket-position");i.addOrRemoveFromCart(i.basket[e]),i.modal.updateOverlayContent(i.listCart()),i.wireUpCartDeletes(),t.preventDefault()})},s=0,l=e;s<l.length;s++){o(l[s])}}else this.modal.closeOverlay(document.getElementById(this.modal.overlayContainerGuts),document.getElementById(this.modal.overlayContainerID),window.scrollY)},t.prototype.listCart=function(){var n=this;if(this.cartCount=this.countCart(),0<this.cartCount){var i='<div id="cartList">';return this.basket.forEach(function(t,e){i+='<div class="cartRow">\n                    <div class="crImg">',"/"!=t.image&&""!=t.image&&(i+='<img src="'+t.image+'" alt="'+t.title+'-image" />'),i+='</div>\n                    <div class="crDesc">\n                        <p>'+t.title,!t.software||t.renew&&(i+=" - Renewing"),i+='</p>\n                        <a class="crDeleteEmbed" data-basket-position="'+e+'" >Delete</a>\n                    </div>\n                    <div class="crDelete"> \n                        <p><a class="crDeleteBtn" data-basket-position="'+e+'" href="">Delete</a></p>\n                    </div>\n                    <div><p>$'+n.numberWithCommas(t.price,!1)+"</p></div>\n                </div>"}),i+='\n                <div class="cartRow">\n                    <div class="crImg">&nbsp;</div>\n                    <div class="crDesc">&nbsp;</div>\n                    <div class="crDelete">Total:</div>\n                    <div>$'+this.numberWithCommas(this.totalCart(),!0)+'</div>\n                </div>\n                <div class="cartRow">\n                    <div class="checkoutRow">\n                        <a id="checkoutNow" href="#" class="button">Checkout Now</a> \n                    </div>\n                </div>\n            ',i+="</div>"}},t.prototype.toggleATCbutton=function(t,e){if(e)t.classList.add("onCart"),t.textContent=this.cartBtnTxt.Remove;else{t.classList.remove("onCart");var n=t.getAttribute("data-price");t.textContent="0.00"!=n&&""!=n?this.cartBtnTxt.Add:"More Info"}t.blur()},t.prototype.numberWithCommas=function(t,e){return void 0===e&&(e=!0),e?t.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.prototype.makeCheckoutURL=function(){if(0<this.basket.length){for(var t=this.machformBase+"&",e=0;e<this.basket.length;e++)this.basket[e].software&&this.basket[e].renew?t+=this.basket[e].renewElement+"=1":t+=this.basket[e].element+"=1",e+1<this.basket.length&&(t+="&");return t}return null},t}(),Store=function(){function t(t,e,n,i,r){this.apiURL="https://feinberg-dev.fsm.northwestern.edu/it-new/ws/json-api.php",this.items=[{}],this.modal=n,this.cookie=i,this.softwareCookie=r,this.cart=e,this.containerEL=document.getElementById(t),this.loadProducts(),this.wireUpAddToCartClicks(),this.fixJump(),this.setJumpers()}return t.prototype.loadProducts=function(){var t=this.cookie.getJSONfromCookieAsArray(),e=this.softwareCookie.getJSONfromCookieAsArray(),n=document.getElementsByClassName("prodBox");if(0<n.length)for(var i=0;i<n.length;i++){var r=n[i],a=r.querySelector("p.visiblePrice");if(a){var o=a.innerHTML;a.innerHTML="$"+this.numberWithCommas(o)}r.setAttribute("data-position",i.toString()),r.querySelector("a.atcBtn").setAttribute("data-position",i.toString());var s=parseFloat(r.getAttribute("data-num"));r.querySelector("a.atcBtn").setAttribute("data-num",s.toString()),"1"===r.getAttribute("data-is-software")&&r.querySelector("select.renewInput").setAttribute("data-num",s.toString());var l={id:s,title:r.querySelector("div.feature-copy div > h6").innerHTML,element:r.getAttribute("data-element"),renewElement:r.getAttribute("data-elementrenew"),price:parseFloat(r.getAttribute("data-price")),desc:r.querySelector("div.feature-copy div.hiddenProdSpecs").innerHTML,software:"1"===r.getAttribute("data-is-software")};r.querySelector("div.img-container > img")?l.image=r.querySelector("div.img-container > img").getAttribute("src"):l.image="";var c=document.querySelector('article.prodBox[data-num="'+l.id+'"] a.atcBtn');if(0<t.length)if(t.includes(l.id))l.onCart=!0,this.cart.toggleATCbutton(c,!0),e.includes(l.id)&&(l.renew=!0),this.cart.addOrRemoveFromCart(new Item(l));else{if(this.cart.toggleATCbutton(c,!1),l.software)document.querySelector('article.prodBox[data-num="'+l.id+'"] select.renewInput').value="new";l.onCart=!1}else if(this.cart.toggleATCbutton(c,!1),l.software)document.querySelector('article.prodBox[data-num="'+l.id+'"] select.renewInput').value="new";this.items[i]=new Item(l)}},t.prototype.wireUpAddToCartClicks=function(){for(var l=this,t=function(s){s.addEventListener("click",function(t){t.preventDefault();var e=s.getAttribute("data-num"),n=s.getAttribute("data-position"),i="1"==s.getAttribute("data-is-software"),r=l.cart.itemInBasket(parseFloat(e)),a=l.items[n].outputOverlay(e,r);l.modal.openOverlay(a);var o=document.getElementById("atcModalBtn");null!=o&&o.addEventListener("click",function(t){return __awaiter(l,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.addToCartToggle(n,o)];case 1:return t.sent(),i&&this.cart.toggleSoftwareSelects(this.items[n].id),this.cart.mapCart(),this.cart.mappedBasket.includes(this.items[n].id)?this.cart.toggleATCbutton(s.getElementsByClassName("atcBtn")[0],!0):this.cart.toggleATCbutton(s.getElementsByClassName("atcBtn")[0],!1),[2]}})})})})},e=0,n=document.getElementsByClassName("prodBox");e<n.length;e++){t(n[e])}for(var i=function(a){a.addEventListener("click",function(t){a.getAttribute("data-num");var e=a.getAttribute("data-position");a.getAttribute("data-is-software");if("0.00"!=l.items[e].price&&"0"!=l.items[e].price&&""!=l.items[e].price){if(l.items[e].software){var n=document.querySelector('article[data-num="'+l.items[e].id+'"] select.renewInput'),i=n.options[n.selectedIndex].value;l.items[e].renew="renew"==i}l.addToCartToggle(e,a),t.preventDefault(),t.stopPropagation()}else{var r=l.items[e].outputOverlay(e,!1);l.modal.openOverlay(r),t.preventDefault(),t.stopPropagation()}})},r=0,a=document.getElementsByClassName("atcBtn");r<a.length;r++){i(a[r])}for(var o=0,s=document.getElementsByClassName("renewInput");o<s.length;o++){s[o].addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()})}},t.prototype.addToCartToggle=function(t,e){this.cart.addOrRemoveFromCart(this.items[t])?(this.items[t].onCart=!0,this.cart.toggleATCbutton(e,!0)):(this.items[t].onCart=!1,this.cart.toggleATCbutton(e,!1),this.items[t].renew=!1)},t.prototype.numberWithCommas=function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.prototype.fixJump=function(){var t=decodeURI(window.location.hash.substr(1));if(t){var e=document.getElementById(t).offsetTop-140;window.scrollTo(0,e)}},t.prototype.setJumpers=function(){for(var t=function(i){i.addEventListener("click",function(t){t.preventDefault();var e=i.getAttribute("href").split("#")[1],n=document.getElementById(e).offsetTop-140;window.scrollTo(0,n)})},e=0,n=document.querySelectorAll("div.jumper > a");e<n.length;e++){t(n[e])}},t}(),Cookie=function(){function t(t){this.name=t}return t.prototype.setCookie=function(t,e){var n=new Date;n.setTime(n.getTime()+864e5*e),document.cookie=this.name+"="+t+";path=/;expires="+n.toUTCString()},t.prototype.getCookie=function(){var t=document.cookie.match("(^|;) ?"+this.name+"=([^;]*)(;|$)");return t?t[2]:null},t.prototype.getJSONfromCookieAsArray=function(){var t=JSON.parse(this.getCookie());return t||[]},t.prototype.deleteCookie=function(){this.setCookie("",-1)},t}(),itAlert=function(){function t(t,e){this.hasAlerts={either:!1,homepageAlert:!1,purchasingAlert:!1},this.modal=t,this.getAlerts(),"purchasing"==e?(this.baseEL=document.getElementById("main-content"),this.type="purchasing"):(this.baseEL=document.getElementById("homepageContent"),this.type="homepage")}return t.prototype.chooseColor=function(t){return"Red"==t?" itDanger ":" itPrimary "},t.prototype.buildBox=function(t){var e='<div class="contain-1440 itAlert '+this.chooseColor(t.color)+' ">\n                    <div class="contain-1120">\n                    \x3c!-- <i class="fa fa-exclamation-triangle fa-2x">&nbsp;</i> --\x3e\n                    <h3>'+t.title+"</h3>\n                    <p>"+t.blurb+"</p>";return void 0!==t.modal&&(e+='<p><a id="alertTrigger" href="#">Read more</a></p>'),e+="</div>  \n                </div>"},t.prototype.buildModalGuts=function(t){return'<div class="bootstrap-wrapper"> \n                    <div class="container">\n                        <div class="row alertRow">\n                            <div class="col-12">'+t.modal+"</div>\n                        </div>\n                    </div>\n                </div>"},t.prototype.addAlertBoxToPage=function(){var e=this.modal,n="";if("homepage"==this.type){var t=this.buildBox(this.alerts.homepageAlert);""!=this.alerts.homepageAlert.modal&&(n=this.buildModalGuts(this.alerts.homepageAlert)),this.baseEL.insertAdjacentHTML("afterbegin",t)}else{t=this.buildBox(this.alerts.purchasingAlert);""!=this.alerts.purchasingAlert.modal&&(n=this.buildModalGuts(this.alerts.purchasingAlert)),this.baseEL.querySelector("h1:first-of-type").insertAdjacentHTML("afterend","<section>"+t+"</section>")}""==n||document.getElementById("alertTrigger")&&(this.trigger=document.getElementById("alertTrigger"),this.trigger.addEventListener("click",function(t){e.openOverlay(n),t.preventDefault()}))},t.prototype.getAlerts=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,fetch("https://feinberg-dev.fsm.northwestern.edu/it-new/ws/json-api.php?type=alerts").then(function(t){return t.json()}).then(function(t){return t})];case 1:return!(e=t.sent()).homepageAlert||"homepage"==this.type&&(this.hasAlerts.either=this.hasAlerts.homepageAlert=!0),!e.purchasingAlert||"purchasing"==this.type&&(this.hasAlerts.either=this.hasAlerts.purchasingAlert=!0),this.hasAlerts&&(this.alerts=e,this.hasAlerts.either&&this.addAlertBoxToPage()),[2]}})})},t}();window.onload=function(){var t=new Cookie("fsmITPurchasing"),e=new Cookie("fsmITPurchasingSoftware"),n=new Modal,i=new Cart(n,t,e);new Store("shopping-cart",i,n,t,e),new itAlert(n,"purchasing")};